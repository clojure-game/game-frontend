{
"version":3,
"file":"goog.mochikit.async.deferred.js",
"lineCount":331,
"mappings":"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",
"sources":["goog/mochikit/async/deferred.js"],
"sourcesContent":["/**\n * @license\n * Copyright 2005, 2007 Bob Ippolito. All Rights Reserved.\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: MIT\n */\n\n// Portions of this code are from MochiKit, received by The Closure\n// Library Authors under the MIT license. All other code is Copyright\n// The Closure Library Authors.\n\n/**\n * @fileoverview Classes for tracking asynchronous operations and handling the\n * results. The Deferred object here is patterned after the Deferred object in\n * the Twisted python networking framework.\n *\n * See: http://twistedmatrix.com/projects/core/documentation/howto/defer.html\n *\n * Based on the Dojo code which in turn is based on the MochiKit code.\n *\n */\n\ngoog.provide('goog.async.Deferred');\ngoog.provide('goog.async.Deferred.AlreadyCalledError');\ngoog.provide('goog.async.Deferred.CanceledError');\n\ngoog.require('goog.Promise');\ngoog.require('goog.Thenable');\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.debug.Error');\n\n\n\n/**\n * A Deferred represents the result of an asynchronous operation. A Deferred\n * instance has no result when it is created, and is \"fired\" (given an initial\n * result) by calling `callback` or `errback`.\n *\n * Once fired, the result is passed through a sequence of callback functions\n * registered with `addCallback` or `addErrback`. The functions may\n * mutate the result before it is passed to the next function in the sequence.\n *\n * Callbacks and errbacks may be added at any time, including after the Deferred\n * has been \"fired\". If there are no pending actions in the execution sequence\n * of a fired Deferred, any new callback functions will be called with the last\n * computed result. Adding a callback function is the only way to access the\n * result of the Deferred.\n *\n * If a Deferred operation is canceled, an optional user-provided cancellation\n * function is invoked which may perform any special cleanup, followed by firing\n * the Deferred's errback sequence with a `CanceledError`. If the\n * Deferred has already fired, cancellation is ignored.\n *\n * Deferreds may be templated to a specific type they produce using generics\n * with syntax such as:\n *\n *    /** @type {goog.async.Deferred<string>} *\\\n *    var d = new goog.async.Deferred();\n *    // Compiler can infer that foo is a string.\n *    d.addCallback(function(foo) {...});\n *    d.callback('string');  // Checked to be passed a string\n *\n * Since deferreds are often used to produce different values across a chain,\n * the type information is not propagated across chains, but rather only\n * associated with specifically cast objects.\n *\n * @param {Function=} opt_onCancelFunction A function that will be called if the\n *     Deferred is canceled. If provided, this function runs before the\n *     Deferred is fired with a `CanceledError`.\n * @param {Object=} opt_defaultScope The default object context to call\n *     callbacks and errbacks in.\n * @constructor\n * @implements {goog.Thenable<VALUE>}\n * @template VALUE\n */\ngoog.async.Deferred = function(opt_onCancelFunction, opt_defaultScope) {\n  'use strict';\n  /**\n   * Entries in the sequence are arrays containing a callback, an errback, and\n   * an optional scope. The callback or errback in an entry may be null.\n   * @type {!Array<!Array>}\n   * @private\n   */\n  this.sequence_ = [];\n\n  /**\n   * Optional function that will be called if the Deferred is canceled.\n   * @type {Function|undefined}\n   * @private\n   */\n  this.onCancelFunction_ = opt_onCancelFunction;\n\n  /**\n   * The default scope to execute callbacks and errbacks in.\n   * @type {Object}\n   * @private\n   */\n  this.defaultScope_ = opt_defaultScope || null;\n\n  /**\n   * Whether the Deferred has been fired.\n   * @type {boolean}\n   * @private\n   */\n  this.fired_ = false;\n\n  /**\n   * Whether the last result in the execution sequence was an error.\n   * @type {boolean}\n   * @private\n   */\n  this.hadError_ = false;\n\n  /**\n   * The current Deferred result, updated as callbacks and errbacks are\n   * executed.\n   * @type {*}\n   * @private\n   */\n  this.result_ = undefined;\n\n  /**\n   * Whether the Deferred is blocked waiting on another Deferred to fire. If a\n   * callback or errback returns a Deferred as a result, the execution sequence\n   * is blocked until that Deferred result becomes available.\n   * @type {boolean}\n   * @private\n   */\n  this.blocked_ = false;\n\n  /**\n   * Whether this Deferred is blocking execution of another Deferred. If this\n   * instance was returned as a result in another Deferred's execution\n   * sequence,that other Deferred becomes blocked until this instance's\n   * execution sequence completes. No additional callbacks may be added to a\n   * Deferred once it is blocking another instance.\n   * @type {boolean}\n   * @private\n   */\n  this.blocking_ = false;\n\n  /**\n   * Whether the Deferred has been canceled without having a custom cancel\n   * function.\n   * @type {boolean}\n   * @private\n   */\n  this.silentlyCanceled_ = false;\n\n  /**\n   * If an error is thrown during Deferred execution with no errback to catch\n   * it, the error is rethrown after a timeout. Reporting the error after a\n   * timeout allows execution to continue in the calling context (empty when\n   * no error is scheduled).\n   * @type {number}\n   * @private\n   */\n  this.unhandledErrorId_ = 0;\n\n  /**\n   * If this Deferred was created by branch(), this will be the \"parent\"\n   * Deferred.\n   * @type {?goog.async.Deferred}\n   * @private\n   */\n  this.parent_ = null;\n\n  /**\n   * The number of Deferred objects that have been branched off this one. This\n   * will be decremented whenever a branch is fired or canceled.\n   * @type {number}\n   * @private\n   */\n  this.branches_ = 0;\n\n  if (goog.async.Deferred.LONG_STACK_TRACES) {\n    /**\n     * Holds the stack trace at time of deferred creation if the JS engine\n     * provides the Error.captureStackTrace API.\n     * @private {?string}\n     */\n    this.constructorStack_ = null;\n    if (Error.captureStackTrace) {\n      const target = {stack: ''};\n      Error.captureStackTrace(target, goog.async.Deferred);\n      // Check if Error.captureStackTrace worked. It fails in gjstest.\n      if (typeof target.stack == 'string') {\n        // Remove first line and force stringify to prevent memory leak due to\n        // holding on to actual stack frames.\n        this.constructorStack_ = target.stack.replace(/^[^\\n]*\\n/, '');\n      }\n    }\n  }\n};\n\n\n/**\n * @define {boolean} Whether unhandled errors should always get rethrown to the\n * global scope. Defaults to false.\n *\n * NOTE(user): This has a surprising side effect that when STRICT_ERRORS\n * is true, successfully resolving a `Deferred` with a value that is `instanceof\n * Error` (other than `CanceledError`, which is treated as _not an error_ for\n * this purpose) will actually cause the `Deferred` to end up in a rejected\n * state. Thus, `Deferred.succeed(new Error()).addErrback(f)` will actually call\n * `f`. This is similar to existing behavior where (independent of\n * STRICT_ERRORS) _errbacks_ that return (rather than throw) any `Error`\n * (including `CanceledError`) will cause a rejection. We believe this behavior\n * is unintended and will try to fix it in the future to be more consistent.\n */\ngoog.async.Deferred.STRICT_ERRORS =\n    goog.define('goog.async.Deferred.STRICT_ERRORS', false);\n\n\n/**\n * @define {boolean} Whether to attempt to make stack traces long.  Defaults to\n * false.\n */\ngoog.async.Deferred.LONG_STACK_TRACES =\n    goog.define('goog.async.Deferred.LONG_STACK_TRACES', false);\n\n\n/**\n * Cancels a Deferred that has not yet been fired, or is blocked on another\n * deferred operation. If this Deferred is waiting for a blocking Deferred to\n * fire, the blocking Deferred will also be canceled.\n *\n * If this Deferred was created by calling branch() on a parent Deferred with\n * opt_propagateCancel set to true, the parent may also be canceled. If\n * opt_deepCancel is set, cancel() will be called on the parent (as well as any\n * other ancestors if the parent is also a branch). If one or more branches were\n * created with opt_propagateCancel set to true, the parent will be canceled if\n * cancel() is called on all of those branches.\n *\n * @param {boolean=} opt_deepCancel If true, cancels this Deferred's parent even\n *     if cancel() hasn't been called on some of the parent's branches. Has no\n *     effect on a branch without opt_propagateCancel set to true.\n */\ngoog.async.Deferred.prototype.cancel = function(opt_deepCancel) {\n  'use strict';\n  if (!this.hasFired()) {\n    if (this.parent_) {\n      // Get rid of the parent reference before potentially running the parent's\n      // canceler function to ensure that this cancellation isn't\n      // double-counted.\n      const parent = this.parent_;\n      delete this.parent_;\n      if (opt_deepCancel) {\n        parent.cancel(opt_deepCancel);\n      } else {\n        parent.branchCancel_();\n      }\n    }\n\n    if (this.onCancelFunction_) {\n      // Call in user-specified scope.\n      this.onCancelFunction_.call(this.defaultScope_, this);\n    } else {\n      this.silentlyCanceled_ = true;\n    }\n    if (!this.hasFired()) {\n      this.errback(new goog.async.Deferred.CanceledError(this));\n    }\n  } else if (this.result_ instanceof goog.async.Deferred) {\n    this.result_.cancel();\n  }\n};\n\n\n/**\n * Handle a single branch being canceled. Once all branches are canceled, this\n * Deferred will be canceled as well.\n *\n * @private\n */\ngoog.async.Deferred.prototype.branchCancel_ = function() {\n  'use strict';\n  this.branches_--;\n  if (this.branches_ <= 0) {\n    this.cancel();\n  }\n};\n\n\n/**\n * Called after a blocking Deferred fires. Unblocks this Deferred and resumes\n * its execution sequence.\n *\n * @param {boolean} isSuccess Whether the result is a success or an error.\n * @param {*} res The result of the blocking Deferred.\n * @private\n */\ngoog.async.Deferred.prototype.continue_ = function(isSuccess, res) {\n  'use strict';\n  this.blocked_ = false;\n  this.updateResult_(isSuccess, res);\n};\n\n\n/**\n * Updates the current result based on the success or failure of the last action\n * in the execution sequence.\n *\n * @param {boolean} isSuccess Whether the new result is a success or an error.\n * @param {*} res The result.\n * @private\n */\ngoog.async.Deferred.prototype.updateResult_ = function(isSuccess, res) {\n  'use strict';\n  this.fired_ = true;\n  this.result_ = res;\n  this.hadError_ = !isSuccess;\n  this.fire_();\n};\n\n\n/**\n * Verifies that the Deferred has not yet been fired.\n *\n * @private\n * @throws {Error} If this has already been fired.\n */\ngoog.async.Deferred.prototype.check_ = function() {\n  'use strict';\n  if (this.hasFired()) {\n    if (!this.silentlyCanceled_) {\n      throw new goog.async.Deferred.AlreadyCalledError(this);\n    }\n    this.silentlyCanceled_ = false;\n  }\n};\n\n\n/**\n * Fire the execution sequence for this Deferred by passing the starting result\n * to the first registered callback.\n * @param {VALUE=} opt_result The starting result.\n */\ngoog.async.Deferred.prototype.callback = function(opt_result) {\n  'use strict';\n  this.check_();\n  this.assertNotDeferred_(opt_result);\n  this.updateResult_(true /* isSuccess */, opt_result);\n};\n\n\n/**\n * Fire the execution sequence for this Deferred by passing the starting error\n * result to the first registered errback.\n * @param {*=} opt_result The starting error.\n */\ngoog.async.Deferred.prototype.errback = function(opt_result) {\n  'use strict';\n  this.check_();\n  this.assertNotDeferred_(opt_result);\n  this.makeStackTraceLong_(opt_result);\n  this.updateResult_(false /* isSuccess */, opt_result);\n};\n\n\n/**\n * A method that is invoked with the reason of Deferred's failure for unhandled\n * errors.\n * @type {function(*)}\n * @private\n */\ngoog.async.Deferred.unhandledErrorHandler_ = (e) => {\n  throw e;\n};\n\n\n/**\n * @param {function(*)} handler A function that will be called with the reason\n *     of Deferred's failure on unhandled errors. If none is specified, errors\n *     will fail with `throw`.\n */\ngoog.async.Deferred.setUnhandledErrorHandler = function(handler) {\n  'use strict';\n  goog.async.Deferred.unhandledErrorHandler_ = handler;\n};\n\n\n/**\n * Attempt to make the error's stack trace be long in that it contains the\n * stack trace from the point where the deferred was created on top of the\n * current stack trace to give additional context.\n * @param {*} error\n * @private\n * @suppress {missingProperties} error.stack\n */\ngoog.async.Deferred.prototype.makeStackTraceLong_ = function(error) {\n  'use strict';\n  if (!goog.async.Deferred.LONG_STACK_TRACES) {\n    return;\n  }\n  if (this.constructorStack_ && goog.isObject(error) && error.stack &&\n      // Stack looks like it was system generated. See\n      // https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\n      (/^[^\\n]+(\\n   [^\\n]+)+/).test(error.stack)) {\n    error.stack =\n        error.stack + '\\nDEFERRED OPERATION:\\n' + this.constructorStack_;\n  }\n};\n\n\n/**\n * Asserts that an object is not a Deferred.\n * @param {*} obj The object to test.\n * @throws {Error} Throws an exception if the object is a Deferred.\n * @private\n */\ngoog.async.Deferred.prototype.assertNotDeferred_ = function(obj) {\n  'use strict';\n  goog.asserts.assert(\n      !(obj instanceof goog.async.Deferred),\n      'An execution sequence may not be initiated with a blocking Deferred.');\n};\n\n\n/**\n * Register a callback function to be called with a successful result. If no\n * value is returned by the callback function, the result value is unchanged. If\n * a new value is returned, it becomes the Deferred result and will be passed to\n * the next callback in the execution sequence.\n *\n * If the function throws an error, the error becomes the new result and will be\n * passed to the next errback in the execution chain.\n *\n * If the function returns a Deferred, the execution sequence will be blocked\n * until that Deferred fires. Its result will be passed to the next callback (or\n * errback if it is an error result) in this Deferred's execution sequence.\n *\n * @param {function(this:T,VALUE):?} cb The function to be called with a\n *     successful result.\n * @param {T=} opt_scope An optional scope to call the callback in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addCallback = function(cb, opt_scope) {\n  'use strict';\n  return this.addCallbacks(cb, null, opt_scope);\n};\n\n\n/**\n * Register a callback function to be called with an error result. If no value\n * is returned by the function, the error result is unchanged. If a new error\n * value is returned or thrown, that error becomes the Deferred result and will\n * be passed to the next errback in the execution sequence.\n *\n * If the errback function handles the error by returning a non-error value,\n * that result will be passed to the next normal callback in the sequence.\n *\n * If the function returns a Deferred, the execution sequence will be blocked\n * until that Deferred fires. Its result will be passed to the next callback (or\n * errback if it is an error result) in this Deferred's execution sequence.\n *\n * @param {function(this:T,?):?} eb The function to be called on an\n *     unsuccessful result.\n * @param {T=} opt_scope An optional scope to call the errback in.\n * @return {!goog.async.Deferred<VALUE>} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addErrback = function(eb, opt_scope) {\n  'use strict';\n  return this.addCallbacks(null, eb, opt_scope);\n};\n\n\n/**\n * Registers one function as both a callback and errback.\n *\n * @param {function(this:T,?):?} f The function to be called on any result.\n * @param {T=} opt_scope An optional scope to call the function in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addBoth = function(f, opt_scope) {\n  'use strict';\n  return this.addCallbacks(f, f, opt_scope);\n};\n\n\n/**\n * Like addBoth, but propagates uncaught exceptions in the errback.\n *\n * @param {function(this:T,?):?} f The function to be called on any result.\n * @param {T=} opt_scope An optional scope to call the function in.\n * @return {!goog.async.Deferred<VALUE>} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addFinally = function(f, opt_scope) {\n  'use strict';\n  return this.addCallbacks(f, function(err) {\n    'use strict';\n    const result = f.call(/** @type {?} */ (this), err);\n    if (result === undefined) {\n      throw err;\n    }\n    return result;\n  }, opt_scope);\n};\n\n\n/**\n * Registers a callback function and an errback function at the same position\n * in the execution sequence. Only one of these functions will execute,\n * depending on the error state during the execution sequence.\n *\n * NOTE: This is not equivalent to {@code def.addCallback().addErrback()}! If\n * the callback is invoked, the errback will be skipped, and vice versa.\n *\n * @param {?(function(this:T,VALUE):?)} cb The function to be called on a\n *     successful result.\n * @param {?(function(this:T,?):?)} eb The function to be called on an\n *     unsuccessful result.\n * @param {T=} opt_scope An optional scope to call the functions in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addCallbacks = function(cb, eb, opt_scope) {\n  'use strict';\n  goog.asserts.assert(!this.blocking_, 'Blocking Deferreds can not be re-used');\n  this.sequence_.push([cb, eb, opt_scope]);\n  if (this.hasFired()) {\n    this.fire_();\n  }\n  return this;\n};\n\n\n/**\n * Implements {@see goog.Thenable} for seamless integration with\n * {@see goog.Promise}.\n * Deferred results are mutable and may represent multiple values over\n * their lifetime. Calling `then` on a Deferred returns a Promise\n * with the result of the Deferred at that point in its callback chain.\n * Note that if the Deferred result is never mutated, and only\n * `then` calls are made, the Deferred will behave like a Promise.\n *\n * @override\n */\ngoog.async.Deferred.prototype.then = function(\n    opt_onFulfilled, opt_onRejected, opt_context) {\n  'use strict';\n  let reject;\n  let resolve;\n\n  const promise = new goog.Promise(function(res, rej) {\n    'use strict';\n    // Copying resolvers to outer scope, so that they are available when the\n    // deferred callback fires (which may be synchronous).\n    resolve = res;\n    reject = rej;\n  });\n  this.addCallbacks(resolve, function(reason) {\n    'use strict';\n    if (reason instanceof goog.async.Deferred.CanceledError) {\n      promise.cancel();\n    } else {\n      reject(reason);\n    }\n    return goog.async.Deferred.CONVERTED_TO_PROMISE_;\n  }, this);\n  return promise.then(opt_onFulfilled, opt_onRejected, opt_context);\n};\ngoog.Thenable.addImplementation(goog.async.Deferred);\n\n\n/**\n * Links another Deferred to the end of this Deferred's execution sequence. The\n * result of this execution sequence will be passed as the starting result for\n * the chained Deferred, invoking either its first callback or errback.\n *\n * @param {!goog.async.Deferred} otherDeferred The Deferred to chain.\n * @return {!goog.async.Deferred} This Deferred.\n */\ngoog.async.Deferred.prototype.chainDeferred = function(otherDeferred) {\n  'use strict';\n  this.addCallbacks(\n      otherDeferred.callback, otherDeferred.errback, otherDeferred);\n  return this;\n};\n\n\n/**\n * Makes this Deferred wait for another Deferred's execution sequence to\n * complete before continuing.\n *\n * This is equivalent to adding a callback that returns `otherDeferred`,\n * but doesn't prevent additional callbacks from being added to\n * `otherDeferred`.\n *\n * @param {!goog.async.Deferred|!goog.Thenable} otherDeferred The Deferred\n *     to wait for.\n * @return {!goog.async.Deferred} This Deferred.\n */\ngoog.async.Deferred.prototype.awaitDeferred = function(otherDeferred) {\n  'use strict';\n  if (!(otherDeferred instanceof goog.async.Deferred)) {\n    // The Thenable case.\n    return this.addCallback(function() {\n      'use strict';\n      return otherDeferred;\n    });\n  }\n  return this.addCallback(goog.bind(otherDeferred.branch, otherDeferred));\n};\n\n\n/**\n * Creates a branch off this Deferred's execution sequence, and returns it as a\n * new Deferred. The branched Deferred's starting result will be shared with the\n * parent at the point of the branch, even if further callbacks are added to the\n * parent.\n *\n * All branches at the same stage in the execution sequence will receive the\n * same starting value.\n *\n * @param {boolean=} opt_propagateCancel If cancel() is called on every child\n *     branch created with opt_propagateCancel, the parent will be canceled as\n *     well.\n * @return {!goog.async.Deferred<VALUE>} A Deferred that will be started with\n *     the computed result from this stage in the execution sequence.\n */\ngoog.async.Deferred.prototype.branch = function(opt_propagateCancel) {\n  'use strict';\n  const d = new goog.async.Deferred();\n  this.chainDeferred(d);\n  if (opt_propagateCancel) {\n    d.parent_ = this;\n    this.branches_++;\n  }\n  return d;\n};\n\n\n/**\n * @return {boolean} Whether the execution sequence has been started on this\n *     Deferred by invoking `callback` or `errback`.\n */\ngoog.async.Deferred.prototype.hasFired = function() {\n  'use strict';\n  return this.fired_;\n};\n\n\n/**\n * @param {*} res The latest result in the execution sequence.\n * @return {boolean} Whether the current result is an error that should cause\n *     the next errback to fire. May be overridden by subclasses to handle\n *     special error types.\n * @protected\n */\ngoog.async.Deferred.prototype.isError = function(res) {\n  'use strict';\n  return res instanceof Error;\n};\n\n\n/**\n * @return {boolean} Whether an errback exists in the remaining sequence.\n * @private\n */\ngoog.async.Deferred.prototype.hasErrback_ = function() {\n  'use strict';\n  return goog.array.some(this.sequence_, function(sequenceRow) {\n    'use strict';\n    // The errback is the second element in the array.\n    return typeof sequenceRow[1] === 'function';\n  });\n};\n\n\n/**\n * Return the most recent value fired.\n *\n * @return {VALUE|undefined}\n * @deprecated This method is only for facilitating migrations from other async\n *     primitives.\n */\ngoog.async.Deferred.prototype.getLastValueForMigration = function() {\n  'use strict';\n  return (this.hasFired() && !this.hadError_) ? this.result_ : undefined;\n};\n\n/** @private @const Marker object returned from `.then()` to `.fire_()`. */\ngoog.async.Deferred.CONVERTED_TO_PROMISE_ = {};\n\n/**\n * Exhausts the execution sequence while a result is available. The result may\n * be modified by callbacks or errbacks, and execution will block if the\n * returned result is an incomplete Deferred.\n *\n * @private\n */\ngoog.async.Deferred.prototype.fire_ = function() {\n  'use strict';\n  if (this.unhandledErrorId_ && this.hasFired() && this.hasErrback_()) {\n    // It is possible to add errbacks after the Deferred has fired. If a new\n    // errback is added immediately after the Deferred encountered an unhandled\n    // error, but before that error is rethrown, the error is unscheduled.\n    goog.async.Deferred.unscheduleError_(this.unhandledErrorId_);\n    this.unhandledErrorId_ = 0;\n  }\n\n  if (this.parent_) {\n    this.parent_.branches_--;\n    delete this.parent_;\n  }\n\n  let res = this.result_;\n  let unhandledException = false;\n  let isNewlyBlocked = false;\n  let wasConvertedToPromise = false;\n\n  while (this.sequence_.length && !this.blocked_) {\n    wasConvertedToPromise = false;\n    const sequenceEntry = this.sequence_.shift();\n\n    const callback = sequenceEntry[0];\n    const errback = sequenceEntry[1];\n    const scope = sequenceEntry[2];\n\n    const f = this.hadError_ ? errback : callback;\n    if (f) {\n      try {\n        let ret = f.call(scope || this.defaultScope_, res);\n\n        if (ret === goog.async.Deferred.CONVERTED_TO_PROMISE_) {\n          wasConvertedToPromise = true;\n          ret = undefined;\n        }\n\n        // If no result, then use previous result.\n        if (ret !== undefined) {\n          // Bubble up the error as long as the return value hasn't changed.\n          this.hadError_ = this.hadError_ && (ret == res || this.isError(ret));\n          this.result_ = res = ret;\n        }\n\n        if (goog.Thenable.isImplementedBy(res) ||\n            (typeof goog.global['Promise'] === 'function' &&\n            res instanceof goog.global['Promise'])) {\n          isNewlyBlocked = true;\n          this.blocked_ = true;\n        }\n\n      } catch (ex) {\n        res = ex;\n        this.hadError_ = true;\n        this.makeStackTraceLong_(res);\n\n        if (!this.hasErrback_()) {\n          // If an error is thrown with no additional errbacks in the queue,\n          // prepare to rethrow the error.\n          unhandledException = true;\n        }\n      }\n    }\n  }\n\n  this.result_ = res;\n\n  if (isNewlyBlocked) {\n    const onCallback = goog.bind(this.continue_, this, true /* isSuccess */);\n    const onErrback = goog.bind(this.continue_, this, false /* isSuccess */);\n\n    if (res instanceof goog.async.Deferred) {\n      res.addCallbacks(onCallback, onErrback);\n      res.blocking_ = true;\n    } else {\n      /** @type {!IThenable} */ (res).then(onCallback, onErrback);\n    }\n  } else if (\n      goog.async.Deferred.STRICT_ERRORS && !wasConvertedToPromise &&\n      this.isError(res) &&\n      !(res instanceof goog.async.Deferred.CanceledError)) {\n    this.hadError_ = true;\n    unhandledException = true;\n  }\n\n  if (unhandledException) {\n    // Rethrow the unhandled error after a timeout. Execution will continue, but\n    // the error will be seen by global handlers and the user. The throw will\n    // be canceled if another errback is appended before the timeout executes.\n    // The error's original stack trace is preserved where available.\n    this.unhandledErrorId_ = goog.async.Deferred.scheduleError_(res);\n  }\n};\n\n\n/**\n * Creates a Deferred that has an initial result.\n *\n * @param {*=} opt_result The result.\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.succeed = function(opt_result) {\n  'use strict';\n  const d = new goog.async.Deferred();\n  d.callback(opt_result);\n  return d;\n};\n\n\n/**\n * Creates a Deferred that fires when the given promise resolves.\n * Use only during migration to Promises.\n *\n * Note: If the promise resolves to a thenable value (which is not allowed by\n * conforming promise implementations), then the deferred may behave\n * unexpectedly as it tries to wait on it. This should not be a risk when using\n * goog.Promise, goog.async.Deferred, or native Promise objects.\n *\n * @param {!IThenable<T>} promise\n * @return {!goog.async.Deferred<T>} The new Deferred.\n * @template T\n */\ngoog.async.Deferred.fromPromise = function(promise) {\n  'use strict';\n  const d = new goog.async.Deferred();\n  promise.then(\n      function(value) {\n        'use strict';\n        d.callback(value);\n      },\n      function(error) {\n        'use strict';\n        d.errback(error);\n      });\n  return d;\n};\n\n\n/**\n * Creates a Deferred that has an initial error result.\n *\n * @param {*} res The error result.\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.fail = function(res) {\n  'use strict';\n  const d = new goog.async.Deferred();\n  d.errback(res);\n  return d;\n};\n\n\n/**\n * Creates a Deferred that has already been canceled.\n *\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.canceled = function() {\n  'use strict';\n  const d = new goog.async.Deferred();\n  d.cancel();\n  return d;\n};\n\n\n/**\n * Normalizes values that may or may not be Deferreds.\n *\n * If the input value is a Deferred, the Deferred is branched (so the original\n * execution sequence is not modified) and the input callback added to the new\n * branch. The branch is returned to the caller.\n *\n * If the input value is not a Deferred, the callback will be executed\n * immediately and an already firing Deferred will be returned to the caller.\n *\n * In the following (contrived) example, if <code>isImmediate</code> is true\n * then 3 is alerted immediately, otherwise 6 is alerted after a 2-second delay.\n *\n * <pre>\n * var value;\n * if (isImmediate) {\n *   value = 3;\n * } else {\n *   value = new goog.async.Deferred();\n *   setTimeout(function() { value.callback(6); }, 2000);\n * }\n *\n * var d = goog.async.Deferred.when(value, alert);\n * </pre>\n *\n * @param {*} value Deferred or normal value to pass to the callback.\n * @param {function(this:T, ?):?} callback The callback to execute.\n * @param {T=} opt_scope An optional scope to call the callback in.\n * @return {!goog.async.Deferred} A new Deferred that will call the input\n *     callback with the input value.\n * @template T\n */\ngoog.async.Deferred.when = function(value, callback, opt_scope) {\n  'use strict';\n  if (value instanceof goog.async.Deferred) {\n    return value.branch(true).addCallback(callback, opt_scope);\n  } else {\n    return goog.async.Deferred.succeed(value).addCallback(callback, opt_scope);\n  }\n};\n\n\n\n/**\n * An error sub class that is used when a Deferred has already been called.\n * @param {!goog.async.Deferred} deferred The Deferred.\n *\n * @constructor\n * @extends {goog.debug.Error}\n */\ngoog.async.Deferred.AlreadyCalledError = function(deferred) {\n  'use strict';\n  goog.debug.Error.call(this);\n\n  /**\n   * The Deferred that raised this error.\n   * @type {goog.async.Deferred}\n   */\n  this.deferred = deferred;\n};\ngoog.inherits(goog.async.Deferred.AlreadyCalledError, goog.debug.Error);\n\n\n/** @override */\ngoog.async.Deferred.AlreadyCalledError.prototype.message =\n    'Deferred has already fired';\n\n\n/** @override */\ngoog.async.Deferred.AlreadyCalledError.prototype.name = 'AlreadyCalledError';\n\n\n\n/**\n * An error sub class that is used when a Deferred is canceled.\n *\n * @param {!goog.async.Deferred} deferred The Deferred object.\n * @constructor\n * @extends {goog.debug.Error}\n */\ngoog.async.Deferred.CanceledError = function(deferred) {\n  'use strict';\n  goog.debug.Error.call(this);\n\n  /**\n   * The Deferred that raised this error.\n   * @type {goog.async.Deferred}\n   */\n  this.deferred = deferred;\n};\ngoog.inherits(goog.async.Deferred.CanceledError, goog.debug.Error);\n\n\n/** @override */\ngoog.async.Deferred.CanceledError.prototype.message = 'Deferred was canceled';\n\n\n/** @override */\ngoog.async.Deferred.CanceledError.prototype.name = 'CanceledError';\n\n\n\n/**\n * Wrapper around errors that are scheduled to be thrown by failing deferreds\n * after a timeout.\n *\n * @param {*} error Error from a failing deferred.\n * @constructor\n * @final\n * @private\n * @struct\n */\ngoog.async.Deferred.Error_ = function(error) {\n  'use strict';\n  /** @const @private {number} */\n  this.id_ = goog.global.setTimeout(goog.bind(this.throwError, this), 0);\n\n  /** @const @private {*} */\n  this.error_ = error;\n};\n\n\n/**\n * Actually throws the error and removes it from the list of pending\n * deferred errors.\n */\ngoog.async.Deferred.Error_.prototype.throwError = function() {\n  'use strict';\n  goog.asserts.assert(\n      goog.async.Deferred.errorMap_[this.id_],\n      'Cannot throw an error that is not scheduled.');\n  delete goog.async.Deferred.errorMap_[this.id_];\n  goog.async.Deferred.unhandledErrorHandler_(this.error_);\n};\n\n\n/**\n * Resets the error throw timer.\n */\ngoog.async.Deferred.Error_.prototype.resetTimer = function() {\n  'use strict';\n  goog.global.clearTimeout(this.id_);\n};\n\n\n/**\n * Map of unhandled errors scheduled to be rethrown in a future timestep.\n * @private {!Object<(number|string), goog.async.Deferred.Error_>}\n */\ngoog.async.Deferred.errorMap_ = {};\n\n\n/**\n * Schedules an error to be thrown after a delay.\n * @param {*} error Error from a failing deferred.\n * @return {number} Id of the error.\n * @private\n */\ngoog.async.Deferred.scheduleError_ = function(error) {\n  'use strict';\n  const deferredError = new goog.async.Deferred.Error_(error);\n  goog.async.Deferred.errorMap_[deferredError.id_] = deferredError;\n  return deferredError.id_;\n};\n\n\n/**\n * Unschedules an error from being thrown.\n * @param {number} id Id of the deferred error to unschedule.\n * @private\n */\ngoog.async.Deferred.unscheduleError_ = function(id) {\n  'use strict';\n  const error = goog.async.Deferred.errorMap_[id];\n  if (error) {\n    error.resetTimer();\n    delete goog.async.Deferred.errorMap_[id];\n  }\n};\n\n\n/**\n * Asserts that there are no pending deferred errors. If there are any\n * scheduled errors, one will be thrown immediately to make this function fail.\n */\ngoog.async.Deferred.assertNoErrors = function() {\n  'use strict';\n  const map = goog.async.Deferred.errorMap_;\n  for (let key in map) {\n    const error = map[key];\n    error.resetTimer();\n    error.throwError();\n  }\n};\n"],
"names":["goog","provide","require","async","Deferred","goog.async.Deferred","opt_onCancelFunction","opt_defaultScope","sequence_","onCancelFunction_","defaultScope_","fired_","hadError_","result_","undefined","blocked_","blocking_","silentlyCanceled_","unhandledErrorId_","parent_","branches_","LONG_STACK_TRACES","constructorStack_","Error","captureStackTrace","target","stack","replace","STRICT_ERRORS","define","prototype","cancel","goog.async.Deferred.prototype.cancel","opt_deepCancel","hasFired","parent","branchCancel_","call","errback","CanceledError","goog.async.Deferred.prototype.branchCancel_","continue_","goog.async.Deferred.prototype.continue_","isSuccess","res","updateResult_","goog.async.Deferred.prototype.updateResult_","fire_","check_","goog.async.Deferred.prototype.check_","AlreadyCalledError","callback","goog.async.Deferred.prototype.callback","opt_result","assertNotDeferred_","goog.async.Deferred.prototype.errback","makeStackTraceLong_","unhandledErrorHandler_","e","goog.async.Deferred.unhandledErrorHandler_","setUnhandledErrorHandler","goog.async.Deferred.setUnhandledErrorHandler","handler","goog.async.Deferred.prototype.makeStackTraceLong_","error","isObject","test","goog.async.Deferred.prototype.assertNotDeferred_","obj","asserts","assert","addCallback","goog.async.Deferred.prototype.addCallback","cb","opt_scope","addCallbacks","addErrback","goog.async.Deferred.prototype.addErrback","eb","addBoth","goog.async.Deferred.prototype.addBoth","f","addFinally","goog.async.Deferred.prototype.addFinally","err","result","goog.async.Deferred.prototype.addCallbacks","push","then","goog.async.Deferred.prototype.then","opt_onFulfilled","opt_onRejected","opt_context","reject","resolve","promise","Promise","rej","reason","CONVERTED_TO_PROMISE_","Thenable","addImplementation","chainDeferred","goog.async.Deferred.prototype.chainDeferred","otherDeferred","awaitDeferred","goog.async.Deferred.prototype.awaitDeferred","bind","branch","goog.async.Deferred.prototype.branch","opt_propagateCancel","d","goog.async.Deferred.prototype.hasFired","isError","goog.async.Deferred.prototype.isError","hasErrback_","goog.async.Deferred.prototype.hasErrback_","array","some","sequenceRow","getLastValueForMigration","goog.async.Deferred.prototype.getLastValueForMigration","goog.async.Deferred.prototype.fire_","unscheduleError_","unhandledException","isNewlyBlocked","wasConvertedToPromise","length","sequenceEntry","shift","scope","ret","isImplementedBy","global","ex","onCallback","onErrback","scheduleError_","succeed","goog.async.Deferred.succeed","fromPromise","goog.async.Deferred.fromPromise","value","fail","goog.async.Deferred.fail","canceled","goog.async.Deferred.canceled","when","goog.async.Deferred.when","goog.async.Deferred.AlreadyCalledError","deferred","debug","inherits","message","name","goog.async.Deferred.CanceledError","Error_","goog.async.Deferred.Error_","id_","setTimeout","throwError","error_","goog.async.Deferred.Error_.prototype.throwError","errorMap_","resetTimer","goog.async.Deferred.Error_.prototype.resetTimer","clearTimeout","goog.async.Deferred.scheduleError_","deferredError","goog.async.Deferred.unscheduleError_","id","assertNoErrors","goog.async.Deferred.assertNoErrors","map","key"]
}
